<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Cache-Control" content="public">
		<meta name="msvalidate.01" content="1AAC6AB2F92622321577453EF16C7E43" />

		<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Random-JPA Integration | Kuros.in</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Random-JPA Integration" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Using Random-JPA to create a simple test data." />
<meta property="og:description" content="Using Random-JPA to create a simple test data." />
<link rel="canonical" href="https://kuros.in/random-jpa/2019/01/rjpa-1-integration/" />
<meta property="og:url" content="https://kuros.in/random-jpa/2019/01/rjpa-1-integration/" />
<meta property="og:site_name" content="Kuros.in" />
<meta property="og:image" content="https://source.unsplash.com/random/1200x900" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-14T00:00:00+00:00" />
<script type="application/ld+json">
{"headline":"Random-JPA Integration","dateModified":"2019-01-14T00:00:00+00:00","datePublished":"2019-01-14T00:00:00+00:00","url":"https://kuros.in/random-jpa/2019/01/rjpa-1-integration/","image":"https://source.unsplash.com/random/1200x900","mainEntityOfPage":{"@type":"WebPage","@id":"https://kuros.in/random-jpa/2019/01/rjpa-1-integration/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://kuros.in/siteicon.png"}},"description":"Using Random-JPA to create a simple test data.","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

		<link type="application/atom+xml" rel="alternate" href="https://kuros.in/feed.xml" title="Kuros.in" />

		<link rel="apple-touch-icon" href="/images/kuros-3.png">
		<link rel="icon" type="image/png" href="/images/kuros-3.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/images/kuros-3.png">

		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300|Rubik:300">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="/css/screen.css">

		        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-131802948-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-131802948-1');
        </script>
        
		
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <script>
                (adsbygoogle = window.adsbygoogle || []).push({
                        google_ad_client: "ca-pub-4166026699724584",
                        enable_page_level_ads: true
                });
        </script>


	</head>

	<body>
		<header id="mainHeader">
			<div class="container">
				<div class="company-name">
					<a href="/">
						<span class="dark-logo"><img width="104" src="/images/logo/dark-2.svg" alt="dark frisco logo"></span>
						<span class="light-logo"><img width="200" src="/images/logo/light-2.svg" alt="light frisco logo"></span>
						<!--<span class="dark-logo">Kuros.in</span>-->
						<!--<span class="light-logo">Kuros.in</span>-->
					</a>
				</div>
				<nav>
	<a class="nav-toggle" id="open-nav" href="#">&#9776;</a>
	
		
		

		
		<a href="/random-jpa/" class="" >Random-JPA</a>
	
		
		

		
		<a href="/blog/" class="" >Blog</a>
	
		
		

		
		<a href="/about/" class="" >About</a>
	
		
		

		
		<a href="/contact/" class="" >Contact</a>
	
</nav>

				<!--<p class="editor-link"><a style="display:inline;" href="/_data/navigation.yml" class="btn"><strong>&#9998;</strong> Edit navigation</a></p>-->
			</div>
		</header>

		<section class="hero page-hero random-images" >
	<div class="inner-hero text-container">
		<div class="hero-text-container">
			<h1>Random-JPA Integration</h1>
			<p class="subtext">Using Random-JPA to create a simple test data.</p>
		</div>
	</div>
</section>

<div id="share-bar" style="display: none">
    <div class="share-buttons">
        <a class="facebook"  href="https://www.facebook.com/sharer/sharer.php?u=https://kuros.in/random-jpa/2019/01/rjpa-1-integration/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Facebook" >
            <i class="fa fa-facebook-official share-button"></i>
        </a>

        <a class="twitter" href="https://twitter.com/intent/tweet?text=Random-JPA Integration&url=https://kuros.in/random-jpa/2019/01/rjpa-1-integration/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Twitter" >
            <i class="fa fa-twitter share-button"></i>
        </a>

        <a  class="tumblr" href="https://www.tumblr.com/share/link?url=https://kuros.in/random-jpa/2019/01/rjpa-1-integration/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Tumblr" >
            <i class="fa fa-tumblr share-button"></i>
        </a>

        <a  class="pinterest" href="https://www.pinterest.com/pin/create/button/?url=https://kuros.in/random-jpa/2019/01/rjpa-1-integration/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Pinterest" >
            <i class="fa fa-pinterest-p share-button"></i>
        </a>

        <a  class="reddit" href="http://www.reddit.com/submit?url=https://kuros.in/random-jpa/2019/01/rjpa-1-integration/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Reddit" >
            <i class="fa fa-reddit-alien share-button"></i>
        </a>

        <a  class="linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://kuros.in/random-jpa/2019/01/rjpa-1-integration/&title=Random-JPA Integration&summary=Using Random-JPA to create a simple test data.&source=Kuros.in"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on LinkedIn" >
            <i class="fa fa-linkedin share-button"></i>
        </a>

        <a  class="email" href="mailto:?subject=Random-JPA Integration&amp;body=Check out this site https://kuros.in/random-jpa/2019/01/rjpa-1-integration/"
            title="Share via Email" >
            <i class="fa fa-envelope share-button"></i>
        </a>
    </div>

</div>

<div id="ad-block-vertical" style="display: none">
    <div class="ad-block-hz">
        

        
        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- ad-vertical -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4166026699724584"
             data-ad-slot="5635008510"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        
    </div>
</div>

<section>
	<div class="blog-post text-container">

		


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


		<p class="post-details">
	
		<span class="blog-filter">
			<a href="/category/random-jpa/">random-jpa</a>
		</span>
	

	
	<span class="post-date">
		January 14, 2019
	</span>
</p>


		<div class="post-content">
			<p>As we have already setup an application, we will go ahead to add latest random-JPA dependency <a href="https://search.maven.org/search?q=g:%22com.github.kuros%22%20AND%20a:%22random-jpa%22"><img src="https://img.shields.io/maven-central/v/com.github.kuros/random-jpa.svg?label=Maven%20Central" alt="Maven Central" /></a></p>

<p>Just add the dependency to your pom.xml, at the time writing this article latest version is 1.0.3</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.github.kuros<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>random-jpa<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0.3<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="problem-statement">Problem Statement</h2>
<p>Let’s say we want to write a query to <strong>fetch the latest salaries each employee</strong>.</p>

<p>Schema relation:</p>

<p><img alt="Employee Salary Relation ship" src="/images/rjpa/salaries.webp" lazyload="" width="300px" /></p>

<p>So our sql query will look like this:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">salaries</span> <span class="n">s</span> <span class="k">where</span> <span class="k">not</span> <span class="k">exists</span><span class="p">(</span><span class="k">select</span> <span class="mi">1</span> <span class="k">from</span> <span class="n">salaries</span> <span class="n">s2</span> <span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">s2</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">and</span> <span class="n">s</span><span class="p">.</span><span class="n">from_date</span> <span class="o">&lt;</span> <span class="n">s2</span><span class="p">.</span><span class="n">from_date</span> <span class="k">and</span> <span class="n">s</span><span class="p">.</span><span class="n">to_date</span> <span class="o">&lt;</span> <span class="n">s2</span><span class="p">.</span><span class="n">to_date</span> <span class="p">);</span>
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">id</th>
      <th style="text-align: center">emp_no</th>
      <th style="text-align: center">salary</th>
      <th style="text-align: center">from_date</th>
      <th style="text-align: center">to_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">10001</td>
      <td style="text-align: center">88958</td>
      <td style="text-align: center">2002-06-22</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">6</td>
      <td style="text-align: center">10002</td>
      <td style="text-align: center">72527</td>
      <td style="text-align: center">2001-08-02</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td style="text-align: center">10003</td>
      <td style="text-align: center">43311</td>
      <td style="text-align: center">2001-12-01</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">12</td>
      <td style="text-align: center">10004</td>
      <td style="text-align: center">74057</td>
      <td style="text-align: center">2001-11-27</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">14</td>
      <td style="text-align: center">10005</td>
      <td style="text-align: center">59755</td>
      <td style="text-align: center">2001-08-02</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
  </tbody>
</table>

<h2 id="adding-jpa-repository">Adding JPA Repository</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">in</span><span class="o">.</span><span class="na">kuros</span><span class="o">.</span><span class="na">randomjpa</span><span class="o">.</span><span class="na">blogexample</span><span class="o">.</span><span class="na">repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">in.kuros.randomjpa.blogexample.entity.Salary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.repository.PagingAndSortingRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.rest.core.annotation.RepositoryRestResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.rest.core.annotation.RestResource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@RepositoryRestResource</span><span class="o">(</span><span class="n">collectionResourceRel</span> <span class="o">=</span> <span class="s">"salary"</span><span class="o">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"salary"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SalaryRepository</span> <span class="kd">extends</span> <span class="nc">PagingAndSortingRepository</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@RestResource</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"latest"</span><span class="o">)</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"FROM Salary s WHERE NOT EXISTS (select 1 FROM Salary s2 WHERE s.employeeId = s2.employeeId and s2.fromDate &lt; s.fromDate and s2.toDate &lt; s.toDate) "</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">&gt;</span> <span class="nf">findLatestSalaries</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now we access the service using the endpoint</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost:8080/salary/search/latest
</code></pre></div></div>

<p>you will get response as:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"_embedded"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10001</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">85112</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-06-22"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2001-06-22"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/1"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10002</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">69366</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1999-08-03"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-08-02"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/4"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/4"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10003</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">43699</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-12-01"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2001-12-01"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/7"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/7"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10004</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">67096</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1998-11-28"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1999-11-28"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/9"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/9"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10005</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">60098</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-08-02"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2001-08-02"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/13"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/13"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/search/latest"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>But something is wrong</strong>, this endpoint is returning incorrect values, eg. Employee 10001 has salary as <strong>85112</strong> but as per our earlier query it should be <strong>88958</strong>.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>There is a bug in our query, that’s why we need integration tests to validate our queries.</p>

<h2 id="time-to-write-test">Time to write test</h2>

<p>Earlier we had mainly two option either we had fixed employee data backup against which the test suite runs, but there were high chances that the data corruption leading to test failures.</p>

<p>Or, developer maintains test fixtures responsible for creating relevant data, but maintaining relationship was the real pain.</p>

<h2 id="random-jpa-in-action">Random-JPA in Action</h2>

<p>Lets start by writing a simple test</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">in</span><span class="o">.</span><span class="na">kuros</span><span class="o">.</span><span class="na">randomjpa</span><span class="o">.</span><span class="na">blogexample</span><span class="o">.</span><span class="na">repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.Database</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.JPAContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.JPAContextFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.persistor.model.ResultMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.types.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">in.kuros.randomjpa.blogexample.entity.Salary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SalaryRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span> <span class="kd">private</span> <span class="nc">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="nd">@Autowired</span> <span class="kd">private</span> <span class="nc">SalaryRepository</span> <span class="n">salaryRepository</span><span class="o">;</span>

    <span class="nd">@Test</span> <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldTestForFetchingSalaryRecordForOnlyOneEntry</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">JPAContext</span> <span class="n">jpaContext</span> <span class="o">=</span> <span class="nc">JPAContextFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="nc">Database</span><span class="o">.</span><span class="na">MY_SQL</span><span class="o">,</span> <span class="n">entityManager</span><span class="o">)</span>
                <span class="o">.</span><span class="na">generate</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">ResultMap</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="n">jpaContext</span><span class="o">.</span><span class="na">createAndPersist</span><span class="o">(</span><span class="nc">Entity</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Salary</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="n">resultMap</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>

        <span class="kd">final</span> <span class="nc">Salary</span> <span class="n">salary</span> <span class="o">=</span> <span class="n">resultMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Salary</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">&gt;</span> <span class="n">latestSalaries</span> <span class="o">=</span> <span class="n">salaryRepository</span><span class="o">.</span><span class="na">findLatestSalaries</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">latestSalaries</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">sal</span> <span class="o">-&gt;</span> <span class="n">sal</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getId</span><span class="o">())).</span><span class="na">findFirst</span><span class="o">();</span>

        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isPresent</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getSalary</span><span class="o">(),</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getSalary</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getFromDate</span><span class="o">(),</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getFromDate</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getToDate</span><span class="o">(),</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getToDate</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>The test passed and it prints below output:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└── *ROOT*
    └── in.kuros.randomjpa.blogexample.entity.Employees|0 [empNo: 10016]
        └── in.kuros.randomjpa.blogexample.entity.Salaries|0 [id: 15]
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="understanding-test-components">Understanding test components</h2>

<p>In the first line of test</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">JPAContext</span> <span class="n">jpaContext</span> <span class="o">=</span> <span class="nc">JPAContextFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="nc">Database</span><span class="o">.</span><span class="na">MY_SQL</span><span class="o">,</span> <span class="n">entityManager</span><span class="o">)</span>
                <span class="o">.</span><span class="na">generate</span><span class="o">();</span>
</code></pre></div></div>
<p>We generated JPAContext using the factory, we provided the database type (in this case MySQL) and the entity manager.</p>

<p>next we told jpaContext to create an entry for Salary</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">ResultMap</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="n">jpaContext</span><span class="o">.</span><span class="na">createAndPersist</span><span class="o">(</span><span class="nc">Entity</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Salaries</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</code></pre></div></div>

<p>Just for auditing/debugging purpose, we printed the hierarchy created by</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resultMap</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</code></pre></div></div>
<p>which prints</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└── *ROOT*
    └── in.kuros.randomjpa.blogexample.entity.Employees|0 [empNo: 10016]
        └── in.kuros.randomjpa.blogexample.entity.Salaries|0 [id: 15]
</code></pre></div></div>
<p>Under the hood, random-jpa has created new employee (id: 10016) &amp; salary (id: 15) record for respective employee.</p>

<p>Once the record is created, random-jpa returns a resultMap which consist of all the entities which has been created, to access the entity you simply get from result map</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">Salary</span> <span class="n">salary</span> <span class="o">=</span> <span class="n">resultMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Salary</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

<p>And you can use this test data for writing your tests.</p>



			


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>


			<div class="blog-navigation">
				
					
					<a class="prev" href="/random-jpa/2019/01/1-data-setup/">&laquo; Setup database & spring boot application</a>
					

					
					<a class="next" href="/random-jpa/2019/01/rjpa-2-integration/">Random-JPA Integration (Contd.) &raquo;</a>

					
				
			</div>

			<div class="author">
				
				
				<div class="square-image" style="background-image: url('/images/about/myphoto.png')"></div>
				<p class="blurb">I like long drives, bike trip & good food. I have passion for coding, esp. Clean-Code.</p>
			</div>






			

			<div id="disqus_thread"></div>
			<script>

				/**
				 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
				 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

                var disqus_config = function () {
                this.page.url = "https://kuros.in/random-jpa/2019/01/rjpa-1-integration/";  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = "/random-jpa/2019/01/rjpa-1-integration"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                };

				(function() { // DON'T EDIT BELOW THIS LINE
					var d = document, s = d.createElement('script');
					s.src = 'https://kuros-in.disqus.com/embed.js';
					s.setAttribute('data-timestamp', +new Date());
					(d.head || d.body).appendChild(s);
				})();
			</script>
			<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			

			


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

		</div>
	</div>
</section>



		<footer>
			<div class="container">
				<!--<p class="editor-link"><a href="/_data/footer.yml" class="btn"><strong>&#9998;</strong> Edit footer</a></p>-->
				<ul class="footer-left-links">
					
						<li>
							<a  href="/random-jpa/" >
								
								Random-JPA
							</a>
						</li>
					
						<li>
							<a  href="/blog/" >
								
								Blog
							</a>
						</li>
					
						<li>
							<a  href="/about/" >
								
								About
							</a>
						</li>
					
						<li>
							<a  href="/contact/" >
								
								Contact
							</a>
						</li>
					
				</ul>
				<ul class="footer-right-links">
					
						<li>
							<a target="_blank" href="https://www.facebook.com/kumarrohit.1010" class="facebook-icon">
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M19,4V7H17A1,1 0 0,0 16,8V10H19V13H16V20H13V13H11V10H13V7.5C13,5.56 14.57,4 16.5,4M20,2H4A2,2 0 0,0 2,4V20A2,2 0 0,0 4,22H20A2,2 0 0,0 22,20V4C22,2.89 21.1,2 20,2Z" /></svg>
	
								
							</a>
						</li>
					
						<li>
							<a target="_blank" href="https://twitter.com/incrv83" class="twitter-icon">
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z" /></svg>
	
								
							</a>
						</li>
					
						<li>
							<a target="_blank" href="https://www.linkedin.com/in/kumar-rohit-9a985517/" class="linkedin-icon">
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M19,19H16V13.7A1.5,1.5 0 0,0 14.5,12.2A1.5,1.5 0 0,0 13,13.7V19H10V10H13V11.2C13.5,10.36 14.59,9.8 15.5,9.8A3.5,3.5 0 0,1 19,13.3M6.5,8.31C5.5,8.31 4.69,7.5 4.69,6.5A1.81,1.81 0 0,1 6.5,4.69C7.5,4.69 8.31,5.5 8.31,6.5A1.81,1.81 0 0,1 6.5,8.31M8,19H5V10H8M20,2H4C2.89,2 2,2.89 2,4V20A2,2 0 0,0 4,22H20A2,2 0 0,0 22,20V4C22,2.89 21.1,2 20,2Z" /></svg>
	
								
							</a>
						</li>
					
						<li>
							<a  href="/feed.xml" class="rss-icon">
								
		<svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"/><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
	
								
							</a>
						</li>
					
				</ul>
				<p class="copyright">
					<a href="https://cloudcannon.com/">
						Template by CloudCannon
					</a>
				</p>
			</div>
		</footer>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script src="/js/main.js"></script>

		<a id="back2Top" title="Back to top" href="#">&#10148;</a>
	</body>
</html>
