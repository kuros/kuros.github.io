<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Random-JPA Integration - Kuros.in</title>
<meta name="description" content="Using Random-JPA to create a simple test data.">


  <meta name="author" content="Kumar Rohit">
  
  <meta property="article:author" content="Kumar Rohit">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Kuros.in">
<meta property="og:title" content="Random-JPA Integration">
<meta property="og:url" content="https://kuros.in/random-jpa/rjpa-1-integration/">


  <meta property="og:description" content="Using Random-JPA to create a simple test data.">







  <meta property="article:published_time" content="2019-01-21T00:00:00+05:30">






<link rel="canonical" href="https://kuros.in/random-jpa/rjpa-1-integration/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://kuros.in/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kuros.in Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
<link rel="icon" type="image/png" href="/images/kuros-3.png" sizes="192x192">
<link rel="icon" type="image/png" href="/images/kuros-3.png">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/images/logo/logo-dark.svg" alt=""></a>
        
        <a class="site-title" href="/">
          Kuros.in
          <span class="site-subtitle">A collection of things I learn and try, simplified.</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/random-jpa/">Random-JPA</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/jfirebase/">jFirebase</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/about/myphoto.png" alt="Kumar Rohit" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Kumar Rohit</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I like long drives, bike trip &amp; good food. I have passion for coding, especially for Clean-Code.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">India</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/incrv83" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/kuros" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Random-JPA Integration">
    <meta itemprop="description" content="As we have already setup an application, we will go ahead to add latest random-JPA dependency ">
    <meta itemprop="datePublished" content="2019-01-21T00:00:00+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Random-JPA Integration
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right">
            
              <nav class="toc">
                <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Contents</h4></header>
                <ul class="toc__menu">
  <li><a href="#problem-statement">Problem Statement</a></li>
  <li><a href="#adding-jpa-repository">Adding JPA Repository</a></li>
  <li><a href="#time-to-write-test">Time to write test</a></li>
  <li><a href="#random-jpa-in-action">Random-JPA in Action</a></li>
  <li><a href="#understanding-test-components">Understanding test components</a></li>
</ul>

              </nav>
            
            
                
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<div class="sidebar_ads sticky">


          

          
          <!-- sky-scrapper -->
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-4166026699724584"
               data-ad-slot="5730852605"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          

</div>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({});
</script> 
            
          </aside>
        
        
        <p>As we have already setup an application, we will go ahead to add latest random-JPA dependency <a href="https://search.maven.org/search?q=g:%22com.github.kuros%22%20AND%20a:%22random-jpa%22"><img src="https://img.shields.io/maven-central/v/com.github.kuros/random-jpa.svg?label=Maven%20Central" alt="Maven Central" /></a></p>

<p>Just add the dependency to your pom.xml, at the time writing this article latest version is 1.0.3</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.github.kuros<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>random-jpa<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0.3<span class="nt">&lt;/version&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<h2 id="problem-statement">Problem Statement</h2>
<p>Let’s say we want to write a query to <strong>fetch the latest salaries each employee</strong>.</p>

<p>Schema relation:</p>

<p><img alt="Employee Salary Relation ship" src="/images/rjpa/salaries.webp" lazyload="" width="300px" /></p>

<p>So our sql query will look like this:</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">salaries</span> <span class="n">s</span> <span class="k">where</span> <span class="k">not</span> <span class="k">exists</span><span class="p">(</span><span class="k">select</span> <span class="mi">1</span> <span class="k">from</span> <span class="n">salaries</span> <span class="n">s2</span> <span class="k">where</span> <span class="n">s</span><span class="p">.</span><span class="n">emp_no</span> <span class="o">=</span> <span class="n">s2</span><span class="p">.</span><span class="n">emp_no</span> <span class="k">and</span> <span class="n">s</span><span class="p">.</span><span class="n">from_date</span> <span class="o">&lt;</span> <span class="n">s2</span><span class="p">.</span><span class="n">from_date</span> <span class="k">and</span> <span class="n">s</span><span class="p">.</span><span class="n">to_date</span> <span class="o">&lt;</span> <span class="n">s2</span><span class="p">.</span><span class="n">to_date</span> <span class="p">);</span>
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">id</th>
      <th style="text-align: center">emp_no</th>
      <th style="text-align: center">salary</th>
      <th style="text-align: center">from_date</th>
      <th style="text-align: center">to_date</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">10001</td>
      <td style="text-align: center">88958</td>
      <td style="text-align: center">2002-06-22</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">6</td>
      <td style="text-align: center">10002</td>
      <td style="text-align: center">72527</td>
      <td style="text-align: center">2001-08-02</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td style="text-align: center">10003</td>
      <td style="text-align: center">43311</td>
      <td style="text-align: center">2001-12-01</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">12</td>
      <td style="text-align: center">10004</td>
      <td style="text-align: center">74057</td>
      <td style="text-align: center">2001-11-27</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
    <tr>
      <td style="text-align: center">14</td>
      <td style="text-align: center">10005</td>
      <td style="text-align: center">59755</td>
      <td style="text-align: center">2001-08-02</td>
      <td style="text-align: center">9999-01-01</td>
    </tr>
  </tbody>
</table>

<h2 id="adding-jpa-repository">Adding JPA Repository</h2>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">in.kuros.randomjpa.blogexample.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">in.kuros.randomjpa.blogexample.entity.Salary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.jpa.repository.Query</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.repository.PagingAndSortingRepository</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.rest.core.annotation.RepositoryRestResource</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.rest.core.annotation.RestResource</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="nd">@RepositoryRestResource</span><span class="o">(</span><span class="n">collectionResourceRel</span> <span class="o">=</span> <span class="s">"salary"</span><span class="o">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"salary"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SalaryRepository</span> <span class="kd">extends</span> <span class="nc">PagingAndSortingRepository</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@RestResource</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"latest"</span><span class="o">)</span>
    <span class="nd">@Query</span><span class="o">(</span><span class="s">"FROM Salary s WHERE NOT EXISTS (select 1 FROM Salary s2 WHERE s.employeeId = s2.employeeId and s2.fromDate &lt; s.fromDate and s2.toDate &lt; s.toDate) "</span><span class="o">)</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">&gt;</span> <span class="nf">findLatestSalaries</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now we access the service using the endpoint</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost:8080/salary/search/latest
</code></pre></div></div>

<p>you will get response as:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"_embedded"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10001</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">85112</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-06-22"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2001-06-22"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/1"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10002</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">69366</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1999-08-03"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-08-02"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/4"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/4"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10003</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">43699</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-12-01"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2001-12-01"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/7"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/7"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10004</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">67096</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1998-11-28"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1999-11-28"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/9"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/9"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"employeeId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">10005</span><span class="p">,</span><span class="w">
      </span><span class="nl">"salary"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">60098</span><span class="p">,</span><span class="w">
      </span><span class="nl">"fromDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2000-08-02"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"toDate"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2001-08-02"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/13"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"salaries"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/13"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"_links"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"self"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"href"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/salary/search/latest"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>But something is wrong</strong>, this endpoint is returning incorrect values, eg. Employee 10001 has salary as <strong>85112</strong> but as per our earlier query it should be <strong>88958</strong>.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>There is a bug in our query, that’s why we need integration tests to validate our queries.</p>

<h2 id="time-to-write-test">Time to write test</h2>

<p>Earlier we had mainly two option either we had fixed employee data backup against which the test suite runs, but there were high chances that the data corruption leading to test failures.</p>

<p>Or, developer maintains test fixtures responsible for creating relevant data, but maintaining relationship was the real pain.</p>

<h2 id="random-jpa-in-action">Random-JPA in Action</h2>

<p>Lets start by writing a simple test</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">in.kuros.randomjpa.blogexample.repository</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.Database</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.JPAContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.JPAContextFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.persistor.model.ResultMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.github.kuros.random.jpa.types.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">in.kuros.randomjpa.blogexample.entity.Salary</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.EntityManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SalaryRepositoryTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span> <span class="kd">private</span> <span class="nc">EntityManager</span> <span class="n">entityManager</span><span class="o">;</span>
    <span class="nd">@Autowired</span> <span class="kd">private</span> <span class="nc">SalaryRepository</span> <span class="n">salaryRepository</span><span class="o">;</span>

    <span class="nd">@Test</span> <span class="nd">@Transactional</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldTestForFetchingSalaryRecordForOnlyOneEntry</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">JPAContext</span> <span class="n">jpaContext</span> <span class="o">=</span> <span class="nc">JPAContextFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="nc">Database</span><span class="o">.</span><span class="na">MY_SQL</span><span class="o">,</span> <span class="n">entityManager</span><span class="o">)</span>
                <span class="o">.</span><span class="na">generate</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">ResultMap</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="n">jpaContext</span><span class="o">.</span><span class="na">createAndPersist</span><span class="o">(</span><span class="nc">Entity</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Salary</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="n">resultMap</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>

        <span class="kd">final</span> <span class="nc">Salary</span> <span class="n">salary</span> <span class="o">=</span> <span class="n">resultMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Salary</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">&gt;</span> <span class="n">latestSalaries</span> <span class="o">=</span> <span class="n">salaryRepository</span><span class="o">.</span><span class="na">findLatestSalaries</span><span class="o">();</span>

        <span class="kd">final</span> <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Salary</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">latestSalaries</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">sal</span> <span class="o">-&gt;</span> <span class="n">sal</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getId</span><span class="o">())).</span><span class="na">findFirst</span><span class="o">();</span>

        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertTrue</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">isPresent</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getSalary</span><span class="o">(),</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getSalary</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getFromDate</span><span class="o">(),</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getFromDate</span><span class="o">());</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="n">salary</span><span class="o">.</span><span class="na">getToDate</span><span class="o">(),</span> <span class="n">result</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">getToDate</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>The test passed and it prints below output:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└── *ROOT*
    └── in.kuros.randomjpa.blogexample.entity.Employees|0 [empNo: 10016]
        └── in.kuros.randomjpa.blogexample.entity.Salaries|0 [id: 15]
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="understanding-test-components">Understanding test components</h2>

<p>In the first line of test</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">JPAContext</span> <span class="n">jpaContext</span> <span class="o">=</span> <span class="nc">JPAContextFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="nc">Database</span><span class="o">.</span><span class="na">MY_SQL</span><span class="o">,</span> <span class="n">entityManager</span><span class="o">)</span>
                <span class="o">.</span><span class="na">generate</span><span class="o">();</span>
</code></pre></div></div>
<p>We generated JPAContext using the factory, we provided the database type (in this case MySQL) and the entity manager.</p>

<p>next we told jpaContext to create an entry for Salary</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">ResultMap</span> <span class="n">resultMap</span> <span class="o">=</span> <span class="n">jpaContext</span><span class="o">.</span><span class="na">createAndPersist</span><span class="o">(</span><span class="nc">Entity</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Salaries</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
</code></pre></div></div>

<p>Just for auditing/debugging purpose, we printed the hierarchy created by</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resultMap</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</code></pre></div></div>
<p>which prints</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>└── *ROOT*
    └── in.kuros.randomjpa.blogexample.entity.Employees|0 [empNo: 10016]
        └── in.kuros.randomjpa.blogexample.entity.Salaries|0 [id: 15]
</code></pre></div></div>
<p>Under the hood, random-jpa has created new employee (id: 10016) &amp; salary (id: 15) record for respective employee.</p>

<p>Once the record is created, random-jpa returns a resultMap which consist of all the entities which has been created, to access the entity you simply get from result map</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">final</span> <span class="nc">Salary</span> <span class="n">salary</span> <span class="o">=</span> <span class="n">resultMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Salary</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</code></pre></div></div>

<p>And you can use this test data for writing your tests.</p>


        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/random-jpa" class="page__taxonomy-item" rel="tag">random-jpa</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-01-21T00:00:00+05:30">January 21, 2019</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Random-JPA+Integration%20https%3A%2F%2Fkuros.in%2Frandom-jpa%2Frjpa-1-integration%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkuros.in%2Frandom-jpa%2Frjpa-1-integration%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkuros.in%2Frandom-jpa%2Frjpa-1-integration%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/random-jpa/rjpa-2-integration/" class="pagination--pager" title="Random-JPA Integration (Contd.)
">Previous</a>
    
    
      <a href="/random-jpa/1-data-setup/" class="pagination--pager" title="Setup database &amp; spring boot application
">Next</a>
    
  </nav>

    </div>
    
    <div class="page__ads__related">
      


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>  

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/messaging/publish-and-consume-kafka-message-in-spring-boot-applicaton/" rel="permalink">Kafka Messaging with Spring Boot
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In my previous article we looked at setting up Kafka on our local machine. Now we will write a spring boot application and integrate Kafka messaging.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/messaging/getting-started-with-kafka-install-and-messaging/" rel="permalink">Getting started with kafka messaging
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In recent times the Kafka has become a buzzword in the industry, it all started with Linkedin trying to manage the large amount of the data across different ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/jfirebase/jFirebase-a-firebase-wrapper-for-java-developers/" rel="permalink">jFirebase - Entity Framework for Firebase/Firestore
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I decided to tryout firebase for my personal projects &amp; learning, having come from traditional SQL background, I am well versed with JPA/Hibernate when d...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/java/microservices/2019/08/parallel-service-execution-in-microservices-architecture-using-completable-future/" rel="permalink">Making parallel service calls in microservice architecture.
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Not so long ago, when I started my development journey, we use to work with single monolith project. The work culture was pretty different compared to curren...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
</div>

<div class="page">
  


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/incrv83" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/kuros" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Kuros.in. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131802948-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131802948-1', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://kuros.in/random-jpa/rjpa-1-integration/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/random-jpa/rjpa-1-integration"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://kuros-in.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  
    <script src="/assets/js/custom.js"></script>
  



  </body>
</html>
