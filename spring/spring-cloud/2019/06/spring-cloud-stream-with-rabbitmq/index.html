<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Event Driven Microservices with Spring Cloud Stream Using Rabbitmq - Kuros.in</title>
<meta name="description" content="Abstracting Messaging in microservices using Spring Cloud Stream">


  <meta name="author" content="Kumar Rohit">
  
  <meta property="article:author" content="Kumar Rohit">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Kuros.in">
<meta property="og:title" content="Event Driven Microservices with Spring Cloud Stream Using Rabbitmq">
<meta property="og:url" content="https://kuros.in/spring/spring-cloud/2019/06/spring-cloud-stream-with-rabbitmq/">


  <meta property="og:description" content="Abstracting Messaging in microservices using Spring Cloud Stream">







  <meta property="article:published_time" content="2019-06-20T00:00:00+00:00">






<link rel="canonical" href="https://kuros.in/spring/spring-cloud/2019/06/spring-cloud-stream-with-rabbitmq/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://kuros.in/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kuros.in Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
<link rel="icon" type="image/png" href="/images/kuros-3.png" sizes="192x192">
<link rel="icon" type="image/png" href="/images/kuros-3.png">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/images/logo/logo-dark.svg" alt=""></a>
        
        <a class="site-title" href="/">
          Kuros.in
          <span class="site-subtitle">A collection of things I learn and try, simplified.</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/random-jpa/">Random-JPA</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/jfirebase/">jFirebase</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
    <div class="sidebar sidebar__sticky">
    
        <nav class="toc">
          <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Contents</h4></header>
            <ul class="toc__menu">
  <li><a href="#spring-cloud-stream">Spring Cloud Stream</a></li>
  <li><a href="#spring-integration">Spring Integration</a></li>
  <li><a href="#basic-concepts">Basic Concepts</a></li>
  <li><a href="#spring-cloud-communication-patterns">Spring Cloud Communication patterns</a></li>
  <li><a href="#setting-up-rabbitmq">Setting up RabbitMQ</a></li>
  <li><a href="#problem-statement">Problem statement</a></li>
  <li><a href="#application">Application</a>
     -  <a href="#enable-scheduling">Enable Scheduling:</a></li>
  <li><a href="#publisher">Publisher</a></li>
  <li><a href="#consumer">Consumer</a></li>
</ul>

        </nav>
    
    
      
    
  </div>
  



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Event Driven Microservices with Spring Cloud Stream Using Rabbitmq">
    <meta itemprop="description" content="In today’s world microservices has taken the software industry by storm, the reason is obvious, it provides loose coupling, microservices are more reliable and scalable compared to monolith applications. You can introduce new components in the workflow without breaking another, and you can still interact with your legacy applications.">
    <meta itemprop="datePublished" content="2019-06-20T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Event Driven Microservices with Spring Cloud Stream Using Rabbitmq
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right  " style="height: 100%;">
            
            
                
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<div class="sidebar_ads">

    <div class="ad">
        

        
            <!-- sky-scrapper -->
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-4166026699724584"
                data-ad-slot="5730852605"
                data-ad-format="auto"
                data-full-width-responsive="true"></ins>

            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        
    </div>

</div>
 
            
          </aside>
        
        <p>In today’s world microservices has taken the software industry by storm, the reason is obvious, it provides loose coupling, microservices are more reliable and scalable compared to monolith applications. You can introduce new components in the workflow without breaking another, and you can still interact with your legacy applications.</p>

<p>But life is not fair, so microservices comes with their own set of challenges. One of the most important of them is how would these microservices should interact with each other.
Should they be using rest endpoint’s (but services fail if requested point is not available), or using messaging but configuring a broker is a pain. What if I designed my application to use rabbitmq but now I want to migrate to AWS kinesis, there is a lot of pain involved in migrating tech stack.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h1 id="spring-cloud-stream">Spring Cloud Stream</h1>
<p>Spring has come up with an abstraction over messaging infrastructure, to make sure, we focus more on business goals rather than technology management. And the solution is <strong>Spring Cloud Stream</strong>.</p>

<p>Spring Cloud Stream(SCS) is build over spring boot and is highly opinionated about the runtime configuration.</p>

<h1 id="spring-integration">Spring Integration</h1>
<p>Spring Cloud Stream uses spring-integration to provide connectivity to message brokers. It uses the concept of <a href="https://docs.spring.io/spring-integration/docs/5.1.2.RELEASE/reference/html/messaging-channels-section.html">MessageChannel</a> to decouples message producers from message consumers.</p>

<p>It also provides the Channel Adapters, which takes in outside message and adapts them to spring message.</p>

<p>There are Service Activators, which are responsible for pulling messages from message channel and call the attached method of service bean.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h1 id="basic-concepts">Basic Concepts</h1>

<p>When we are taking about Cloud Streams, there are some basic concepts that we need to remember:</p>
<ul>
  <li>Apps are going to communicate with each other via channels.</li>
  <li>All the middleware will be abstracted by Binders, it the job of the binder to how to connect with the physical endpoints like queues, topics etc. Spring Cloud Stream auto detects the binders based on the classpath, and configures them. You can create multiple brokers of the same type, even you can configure multiple binders e.g. Kafka or Rabbitmq to send the same message on different channels.</li>
  <li>Cloud Streams provide @StreamListener to pull objects from message channel. You can create multiple conditional listeners.</li>
</ul>

<h1 id="spring-cloud-communication-patterns">Spring Cloud Communication patterns</h1>
<p>Spring Cloud Stream uses 3 different patterns to communicate over channels.</p>

<ol>
  <li>Publisher/Subscriber: Message is broadcast, all the listeners will be notified.
 <img alt="pub/sub" src="/images/loader.svg" data-src="/images/2019/spring/SCS-pub-sub.png" class="lazy img-center img-half" /></li>
  <li>Consumer Groups: This concept was introduced by Kafka for the first time. Here the message will be broadcast, but now the consumer are divided in groups, each group will receive the message, but only one of the consumer will process it. You don’t need to have Kafka, SCS provides wrapper logic to manage consumer groups internally.
 <img alt="Consumer Group" src="/images/loader.svg" data-src="/images/2019/spring/SCS-consumer-group.png" class="lazy img-center img-half" /></li>
  <li>Partitioning: This is a very strong feature provided by SCS, you can send the message and consumer will be partitioned based on the condition. so each partition will be handling the respective data independently. 
 <img alt="Partition" src="/images/loader.svg" data-src="/images/2019/spring/SCS-partition.png" class="lazy img-center img-half" /></li>
</ol>

<h1 id="setting-up-rabbitmq">Setting up RabbitMQ</h1>
<p>We are going to use RabbitMQ as our binging channel, we are going to run rabbitMQ inside docker container.</p>

<p>User the following command to run docker instance.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--hostname</span> my-rabbit <span class="nt">--name</span> some-rabbit <span class="nt">-p</span> 15672:15672 <span class="nt">-p</span> 5672:5672 rabbitmq:3-management
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Unable to find image <span class="s1">'rabbitmq:3-management'</span> locally
3-management: Pulling from library/rabbitmq
5b7339215d1d: Pull <span class="nb">complete 
</span>14ca88e9f672: Pull <span class="nb">complete 
</span>a31c3b1caad4: Pull <span class="nb">complete 
</span>b054a26005b7: Pull <span class="nb">complete 
</span>eef17c6cb6cf: Pull <span class="nb">complete 
</span>2f1b018e55d1: Downloading <span class="o">[========================&gt;</span>                          <span class="o">]</span>  16.64MB/34.14MB
6cb106540743: Download <span class="nb">complete 
</span>88b93ace2192: Download <span class="nb">complete 
</span>609cd90dbc7b: Download <span class="nb">complete 
</span>c9ee32f1144b: Download <span class="nb">complete 
</span>fefc85bff58e: Download <span class="nb">complete 
</span>33624b12c0ed: Downloading <span class="o">[===================&gt;</span>                               <span class="o">]</span>  4.021MB/10.14MB
Digest: sha256:a8c1e0f2cea371b4860df47a53294876d6874fe68fa12c416e39cef307e75bcd
Status: Downloaded newer image <span class="k">for </span>rabbitmq:3-management
fa09ea9000b27817fd22bcb623d2e844c892e22d1b9eedd22402abe19344b9b9
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- horizontal - responsive -->
<p><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-4166026699724584" data-ad-slot="7276848543" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Once the download is complete, it would fire up the container. To verify your container is up:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker ps

CONTAINER ID        IMAGE                   COMMAND                  CREATED             STATUS              PORTS                                                                    NAMES
fa09ea9000b2        rabbitmq:3-management   <span class="s2">"docker-entrypoint.s…"</span>   2 minutes ago       Up 2 minutes        4369/tcp, 5671-5672/tcp, 15671/tcp, 25672/tcp, 0.0.0.0:8080-&gt;15672/tcp   some-rabbit
</code></pre></div></div>

<p>To access the rabbitMQ console login to <em>http://localhost:15672/</em>. which is available on the standard management port of 15672, with the default username and password of guest / guest
<img alt="rabbit mq login" src="/images/loader.svg" data-src="/images/2019/spring/rabbit-mq-login.png" class="lazy img-center img-half" /></p>

<p>After login the console is available:
<img alt="rabbit mq console" src="/images/loader.svg" data-src="/images/2019/spring/rabbitmq-console.png" class="lazy img-center img-half" /></p>

<h1 id="problem-statement">Problem statement</h1>

<p>Before we proceed let’s create a problem statement we are trying to solve with messaging. Assume we have an Online Order service, when someone places the order, we log the orders for auditing, send the order for packaging. We have an independent logging system and now we need to connect our main application logging system.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h1 id="application">Application</h1>
<p>Now we will create a spring boot application and add the following dependencies:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-stream<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-stream-binder-rabbit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>we will also need to add bom import</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;dependencyManagement&gt;</span>
        <span class="nt">&lt;dependencies&gt;</span>
            <span class="nt">&lt;dependency&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>Greenwich.RELEASE<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;/dependencies&gt;</span>
    <span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div>
<p>Since we have given binder for rabbitmq, spring cloud will autoconfigure the binding.</p>

<p>Let’s initialize rabbitmq connection details, add the following lines in your <code class="language-plaintext highlighter-rouge">application.properties</code> file.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.rabbitmq.host=127.0.0.1
spring.rabbitmq.port=5672
spring.rabbitmq.username=guest
spring.rabbitmq.password=guest
</code></pre></div></div>

<p>Next step is to define channels through which we want to communicate, Spring has provided 3 types of channel out of the box(we will be using mostly custom channels in prod, but for this article we will stick to provided channel).</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<ol>
  <li>
    <p>Sink: Consumer binding</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Sink</span> <span class="o">{</span>
    
    <span class="nc">String</span> <span class="no">INPUT</span> <span class="o">=</span> <span class="s">"input"</span><span class="o">;</span>
    
   <span class="nd">@Input</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">INPUT</span><span class="o">)</span>
   <span class="nc">SubscribableChannel</span> <span class="nf">input</span><span class="o">();</span>
 <span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>Source: Producer binding
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Source</span> <span class="o">{</span>
   
  <span class="nc">String</span> <span class="no">OUTPUT</span> <span class="o">=</span> <span class="s">"output"</span><span class="o">;</span>
   
  <span class="nd">@Output</span><span class="o">(</span><span class="nc">Source</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">)</span>
  <span class="nc">MessageChannel</span> <span class="nf">output</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>Processor: combination of Sink &amp; Source, consumes message &amp; also produces it.
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Processor</span> <span class="kd">extends</span> <span class="nc">Source</span><span class="o">,</span> <span class="nc">Sink</span> <span class="o">{}</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>In our sample application we produce one event every 5 seconds with a spring Scheduler.</p>

<h3 id="enable-scheduling">Enable Scheduling:</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableScheduling</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringCloudStreamRabbitmqPubApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">SpringCloudStreamRabbitmqPubApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>we will create a payload class, in this case:</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">orderNumber</span><span class="o">;</span>

    <span class="c1">// getter  and setters ...</span>
<span class="o">}</span>
</code></pre></div></div>
<h1 id="publisher">Publisher</h1>

<p>Now we create an order service to produce orders every 5 sec.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="nc">Source</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderPublisher</span> <span class="o">{</span>

    <span class="nd">@Autowired</span> <span class="nc">Source</span> <span class="n">source</span><span class="o">;</span>

    <span class="nd">@Scheduled</span><span class="o">(</span><span class="n">fixedDelay</span> <span class="o">=</span> <span class="mi">5000</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">publishOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="nc">Message</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">message</span> <span class="o">=</span> <span class="nc">MessageBuilder</span><span class="o">.</span><span class="na">withPayload</span><span class="o">(</span><span class="k">new</span> <span class="nc">Order</span><span class="o">(</span><span class="s">"Order Number: "</span> <span class="o">+</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">())).</span><span class="na">build</span><span class="o">();</span>
        <span class="n">source</span><span class="o">.</span><span class="na">output</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Order</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nc">LocalDateTime</span> <span class="n">localDateTime</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Order</span><span class="o">(</span><span class="kd">final</span> <span class="nc">LocalDateTime</span> <span class="n">localDateTime</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">localDateTime</span> <span class="o">=</span> <span class="n">localDateTime</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">LocalDateTime</span> <span class="nf">getLocalDateTime</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">localDateTime</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>At line 2, we used <code class="language-plaintext highlighter-rouge">@EnableBinding</code> and provided <code class="language-plaintext highlighter-rouge">Source</code> channel, then we autowired Source to publish message to channel. We have used <code class="language-plaintext highlighter-rouge">@Scheduled</code> to execute method every 5 sec.</p>

<p>Now when we run the application we can verify if our message is getting published in rabbitmq, let’s check its management console.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>We can notice a new topic has been created in Exchanges with the name output to match the interface.</p>

<p><img alt="rabbit mq console channel" src="/images/loader.svg" data-src="/images/2019/spring/rabbitmq-pub-active.png" class="lazy img-center img-half" /></p>

<p>And we can see a message being published to the newly create output topic.
<img alt="rabbit mq console channel 2" src="/images/loader.svg" data-src="/images/2019/spring/rabbitmq-pub-channel-2.png" class="lazy img-center img-half" /></p>

<h1 id="consumer">Consumer</h1>

<p>Now lets create a logging listener which will receive the message.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.cloud.stream.annotation.EnableBinding</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cloud.stream.annotation.StreamListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.cloud.stream.messaging.Sink</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.messaging.Message</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoggingListener</span> <span class="o">{</span>

    <span class="nd">@StreamListener</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">INPUT</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="nc">Message</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">orderMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">orderMessage</span><span class="o">.</span><span class="na">getPayload</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now if we run our application again, we can see a new exchange has been added in rabbitmq
<img alt="rabbit mq console input" src="/images/loader.svg" data-src="/images/2019/spring/rabbitmq-input.png" class="lazy img-center img-half" /></p>

<p>And also a queue is generated something like this
<img alt="rabbit mq console input" src="/images/loader.svg" data-src="/images/2019/spring/rabbitmq-input-queue.png" class="lazy img-center img-half" /></p>

<p>But we are still not receiving any message?. Ok lets see what we are missing, we have created a channel for output named as <code class="language-plaintext highlighter-rouge">output</code>, a channel for receiving the message named as <code class="language-plaintext highlighter-rouge">input</code>, but we have not attached these channels, so lets do this.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>In you <code class="language-plaintext highlighter-rouge">application.properties</code> add the following properties.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.cloud.stream.bindings.input.destination=order
spring.cloud.stream.bindings.output.destination=order
</code></pre></div></div>

<p>We are saying both input.destination &amp; output.destination maps to a new channel named as <code class="language-plaintext highlighter-rouge">order</code></p>

<p>When we run the application, messages start getting printed in console.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Order Number: 1561241483425
Order Number: 1561241493487
Order Number: 1561241503487
Order Number: 1561241513490
Order Number: 1561241523494
Order Number: 1561241533496
</code></pre></div></div>

<p>Let’s take a look at rabbitmq, if we look into <code class="language-plaintext highlighter-rouge">order</code> details, we see now it has a binding to <code class="language-plaintext highlighter-rouge">order.xxxx.xxxx</code> queue rather than <code class="language-plaintext highlighter-rouge">input</code> queue.</p>

<p><img alt="rabbit mq console input" src="/images/loader.svg" data-src="/images/2019/spring/rabbitmq-order.png" class="lazy img-center img-half" /></p>

<p>Congratulations, we have created our first spring cloud stream application.</p>

<p><a href="https://github.com/kuros/blog-code/tree/master/spring/spring-cloud-stream-rabbitmq/publisher">Download the complete code</a>.</p>


        

      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/spring-cloud" class="page__taxonomy-item" rel="tag">spring-cloud</a><span class="sep">, </span>
    
      
      
      <a href="/categories/spring" class="page__taxonomy-item" rel="tag">spring</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-06-20T00:00:00+00:00">June 20, 2019</time></p>


        


<div class="author__scope" itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/about/myphoto.png" alt="Kumar Rohit" itemprop="image">
      
    </div>
  

  <div class="author__content">
    <div class="author__written">WRITTEN BY</div>
    
      <h3 class="author__name" itemprop="name">Kumar Rohit</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I like long drives, bike trip &amp; good food. I have passion for coding, especially for Clean-Code.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">India</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/incrv83" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/kuros" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>
 
      </footer>

      

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Event+Driven+Microservices+with+Spring+Cloud+Stream+Using+Rabbitmq%20https%3A%2F%2Fkuros.in%2Fspring%2Fspring-cloud%2F2019%2F06%2Fspring-cloud-stream-with-rabbitmq%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkuros.in%2Fspring%2Fspring-cloud%2F2019%2F06%2Fspring-cloud-stream-with-rabbitmq%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkuros.in%2Fspring%2Fspring-cloud%2F2019%2F06%2Fspring-cloud-stream-with-rabbitmq%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/java/streams/2019/05/custom-collector/" class="pagination--pager" title="Java 8 - Creating a Custom Collector for Streams
">Previous</a>
    
    
      <a href="/grpc/2019/08/handling-grpc-authorization-using-context/" class="pagination--pager" title="Handling gRPC Authorization using Context in Java
">Next</a>
    
  </nav>

    </div>
    
    <div class="page__ads__related">
      


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>  

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/gcp/ci/cd/sequential-build-number-of-artifacts-in-gcp-cloud-build/" rel="permalink">Sequential build numbers of artifacts in gcp cloud build
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Cloud build is managed service in Google Cloud Platform Infrastructure to offer CI/CD feature. 
As it is quite known, these days CI/CD has become the backbon...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/java/streams/handle-nullpointerexception-in-collectors-tomap/" rel="permalink">How to handle NullPointerException in Collectors.toMap when a mapped value is null
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In Java 8, Collectors.toMap throws NullPointerException when one of the mapped value is null. This is a known bug in OpenJDK. There are many workaround to ha...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/testing/testing-email-using-mock-email-server/" rel="permalink">How I reduced the build execution time for email connectors using mock email servers.
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I checked in my changes, time to wait for the build to be completed in jenkins. It was time to pick up coffee and play the waiting game, as it would take ano...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/messaging/publish-and-consume-kafka-message-in-spring-boot-applicaton/" rel="permalink">Kafka Messaging with Spring Boot
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In my previous article we looked at setting up Kafka on our local machine. Now we will write a spring boot application and integrate Kafka messaging.

</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
</div>

<div class="page">
  


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/incrv83" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/kuros" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Kuros.in. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131802948-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131802948-1', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://kuros.in/spring/spring-cloud/2019/06/spring-cloud-stream-with-rabbitmq/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/spring/spring-cloud/2019/06/spring-cloud-stream-with-rabbitmq"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://kuros-in.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  
    <script src="/assets/js/custom.js"></script>
  



  </body>
</html>
