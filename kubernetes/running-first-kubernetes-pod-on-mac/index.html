<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Running First Kubernetes Pod on Mac (Windows) - Kuros.in</title>
<meta name="description" content="All you need is 60 minutes to run your first application in Kubernetes.">


  <meta name="author" content="Kumar Rohit">
  
  <meta property="article:author" content="Kumar Rohit">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Kuros.in">
<meta property="og:title" content="Running First Kubernetes Pod on Mac (Windows)">
<meta property="og:url" content="https://kuros.in/kubernetes/running-first-kubernetes-pod-on-mac/">


  <meta property="og:description" content="All you need is 60 minutes to run your first application in Kubernetes.">







  <meta property="article:published_time" content="2019-02-08T00:00:00+05:30">






<link rel="canonical" href="https://kuros.in/kubernetes/running-first-kubernetes-pod-on-mac/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "https://kuros.in/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Kuros.in Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">
<link rel="icon" type="image/png" href="/images/kuros-3.png" sizes="192x192">
<link rel="icon" type="image/png" href="/images/kuros-3.png">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/images/logo/logo-dark.svg" alt=""></a>
        
        <a class="site-title" href="/">
          Kuros.in
          <span class="site-subtitle">A collection of things I learn and try, simplified.</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/random-jpa/">Random-JPA</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/jfirebase/">jFirebase</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/about/myphoto.png" alt="Kumar Rohit" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Kumar Rohit</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>I like long drives, bike trip &amp; good food. I have passion for coding, especially for Clean-Code.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">India</span>
        </li>
      

      
        
          
            <li><a href="https://twitter.com/incrv83" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://github.com/kuros" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Running First Kubernetes Pod on Mac (Windows)">
    <meta itemprop="description" content="All you need is 60 minutes to run your first application in Kubernetes, in this post we will install docker with kubernetes on our local machine, create a simple app and its docker image and finally deploy it on our kubernetes cluster.">
    <meta itemprop="datePublished" content="2019-02-08T00:00:00+05:30">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Running First Kubernetes Pod on Mac (Windows)
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          10 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            
            
                


     <div class="sidebar_ads sticky">
          

          
          <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <!-- sky-scrapper -->
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-4166026699724584"
               data-ad-slot="5730852605"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>
               (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
          
     </div>
 
            
          </aside>
        
        
        <p>All you need is 60 minutes to run your first application in Kubernetes, in this post we will install docker with kubernetes on our local machine, create a simple app and its docker image and finally deploy it on our kubernetes cluster.</p>

<p><strong>Note:</strong> The minimum docker desktop version required for kubernetes is <strong>18.09.1</strong></p>

<h1 id="installing-docker-desktop">Installing Docker Desktop</h1>
<p>First thing first, we need to install Docker Desktop, download the <a href="https://www.docker.com/products/docker-desktop">latest version</a></p>

<p>Installation of docker is easy, I will installing docker on Mac (for Windows, process is similar). Please follow the instruction provided on site and download the installer.</p>

<h2 id="install-it">Install it</h2>
<p>Double-click Docker.dmg to start the install process.</p>

<p>When the installation completes and Docker starts, the whale in the top status bar shows that Docker is running, and accessible from a terminal.</p>

<p><img alt="docker-fish" src="/images/loader.svg" data-src="/images/2019/k8s/docker-fish.png" class="lazy" width="50%" /></p>

<h2 id="verify">Verify</h2>

<p>Open command line terminal, and try if docker is installed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker version
Client: Docker Engine - Community
 Version:           18.09.1
 API version:       1.39
 Go version:        go1.10.6
 Git commit:        4c52b90
 Built:             Wed Jan  9 19:33:12 2019
 OS/Arch:           darwin/amd64
 Experimental:      <span class="nb">false

</span>Server: Docker Engine - Community
 Engine:
  Version:          18.09.1
  API version:      1.39 <span class="o">(</span>minimum version 1.12<span class="o">)</span>
  Go version:       go1.10.6
  Git commit:       4c52b90
  Built:            Wed Jan  9 19:41:49 2019
  OS/Arch:          linux/amd64
  Experimental:     <span class="nb">true</span>
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h1 id="enable-kubernetes">Enable Kubernetes</h1>
<p>Open Docker preferences/settings, go to Kubernetes tab(only available after version 18.09.1) &amp; enable it.</p>

<p><img alt="docker-fish" src="/images/loader.svg" data-src="/images/2019/k8s/docker-pref.png" class="lazy" width="50%" /></p>

<p>Once the Kubernetes is started, you will see green indicator for both k8s &amp; docker.</p>

<p><img alt="docker-fish" src="/images/loader.svg" data-src="/images/2019/k8s/docker-status.png" class="lazy" width="50%" /></p>

<p><strong>Congratulations !!!</strong> you have a single node cluster ready.</p>

<h2 id="exploring-the-cluster">Exploring the cluster</h2>
<p>Docker Desktop also install kubectl at location <code class="language-plaintext highlighter-rouge">/usr/local/bin/kubectl</code>, we will verify that we have a running node.</p>

<p>Use the below command get the running nodes</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get nodes
NAME                 STATUS   ROLES    AGE   VERSION
docker-for-desktop   Ready    master   12m   v1.10.11
</code></pre></div></div>

<p>We will check for running services</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get services
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>   AGE
kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   12m
</code></pre></div></div>

<p>We can also verify cluster information</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl cluster-info
Kubernetes master is running at https://localhost:6443
KubeDNS is running at https://localhost:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use <span class="s1">'kubectl cluster-info dump'</span><span class="nb">.</span>
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>But when we try access the url in browser, we get an authentication failure.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://localhost:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Status"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Failure"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"services </span><span class="se">\"</span><span class="s2">kube-dns:dns</span><span class="se">\"</span><span class="s2"> is forbidden: User </span><span class="se">\"</span><span class="s2">system:anonymous</span><span class="se">\"</span><span class="s2"> cannot get services/proxy in the namespace </span><span class="se">\"</span><span class="s2">kube-system</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Forbidden"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kube-dns:dns"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"services"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>It looks like we’re being blocked by the cluster’s RBAC policies. The <em>system:anonymous</em> user is being prevented from listing the namespaces in the cluster.</p>

<p>We need to create a clusterrolebinding that adds the system:anonymous user to the cluster-admin role.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create clusterrolebinding cluster-system-anonymous <span class="nt">--clusterrole</span><span class="o">=</span>cluster-admin <span class="nt">--user</span><span class="o">=</span>system:anonymous
</code></pre></div></div>

<p>Now if you will access</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://localhost:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</code></pre></div></div>
<p>You will get response something like this, it gives all the details related to the running service</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"kind"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"apiVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kube-dns"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kube-system"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"selfLink"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/api/v1/namespaces/kube-system/services/kube-dns"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c25ab536-2b7a-11e9-a713-025000000001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"resourceVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"175"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"creationTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-02-08T08:23:05Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"labels"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"k8s-app"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kube-dns"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"kubernetes.io/cluster-service"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"kubernetes.io/name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"KubeDNS"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"spec"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dns"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UDP"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">53</span><span class="p">,</span><span class="w">
        </span><span class="nl">"targetPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">53</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dns-tcp"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"TCP"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">53</span><span class="p">,</span><span class="w">
        </span><span class="nl">"targetPort"</span><span class="p">:</span><span class="w"> </span><span class="mi">53</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"selector"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"k8s-app"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kube-dns"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"clusterIP"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.96.0.10"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ClusterIP"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sessionAffinity"</span><span class="p">:</span><span class="w"> </span><span class="s2">"None"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"loadBalancer"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>So now since we have a running cluster we will create a simple app &amp; deploy it.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h1 id="the-java-app">The Java App</h1>

<p>We will create a simple java app which will return the IP of the machine. we will create a spring boot application.</p>

<p>The Pom file:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.1.2.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;relativePath/&gt;</span> <span class="c">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>in.kuros.k8s<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>machine-ip<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>0.0.1<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;name&gt;</span>machine-ip<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;description&gt;</span>Demo project for Spring Boot<span class="nt">&lt;/description&gt;</span>

    <span class="nt">&lt;properties&gt;</span>
        <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>
<p>We will initialize Spring Boot Application:</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.boot.SpringApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>

<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MachineIpApplication</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">MachineIpApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>And are simple rest controller which returns ip of the machine.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.net.InetAddress</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.UnknownHostException</span><span class="o">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IpController</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/ip"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseModel</span> <span class="nf">getIp</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">UnknownHostException</span> <span class="o">{</span>
        <span class="nc">InetAddress</span> <span class="n">inetAddress</span> <span class="o">=</span> <span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseModel</span><span class="o">(</span><span class="n">inetAddress</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">(),</span> <span class="n">inetAddress</span><span class="o">.</span><span class="na">getHostName</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">ResponseModel</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">ip</span><span class="o">;</span>
        <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">hostname</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">ResponseModel</span><span class="o">(</span><span class="kd">final</span> <span class="nc">String</span> <span class="n">ip</span><span class="o">,</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">hostname</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">hostname</span> <span class="o">=</span> <span class="n">hostname</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getIp</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getHostname</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">hostname</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Time to test, run the application after mvn build:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>mvn <span class="nb">install</span>
<span class="nv">$ </span>java <span class="nt">-jar</span> target/machine-ip-0.0.1.jar
</code></pre></div></div>

<p>Once the application is up, we will hit exposed rest method and it will return the ip &amp; hostname (something like this)</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl localhost:8080/ip
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"192.168.0.104"</span>,<span class="s2">"hostname"</span>:<span class="s2">"kuros-MacBook-Pro.local"</span><span class="o">}</span>
</code></pre></div></div>

<p>So now we have our sample application ready, time to create docker image.</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h1 id="dockerfile">Dockerfile</h1>

<p>We will create a file named as <strong>Dockerfile</strong> in our home folder.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> openjdk:8-jdk-alpine</span>
<span class="k">COPY</span><span class="s"> target/machine-ip-0.0.1.jar app.jar</span>
<span class="k">EXPOSE</span><span class="s"> 8080</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["java","-jar","/app.jar"]</span>
</code></pre></div></div>

<p>Let’s look at this dockerfile line by line.</p>

<ol>
  <li>Line 1: we are specifying docker to download openjdk image (tag: 8-jdk-alpine).</li>
  <li>Line 2: copy the generated jar file to docker image with name app.jar</li>
  <li>Line 3: We are exposing 8080 port from the container</li>
  <li>Line 4: finally we are giving command to run the app.jar when container starts.</li>
</ol>

<h2 id="building-the-docker-image">Building the Docker image</h2>
<p>So we have created our dockerfile, now time to build an image.</p>

<p>We will user <em>docker build</em> command. We are provinding a tag (<YOUR_DOCKER_ID>/machine-ip:0.0.1) using _-t_. Do not forget to add " . " at the end, this specifies the location of the docker file (if you are using a custom location use -f arg for file location).</YOUR_DOCKER_ID></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span> docker build <span class="nt">-t</span> incrediblevicky/machine-ip:0.0.1 <span class="nb">.</span>

Sending build context to Docker daemon  33.46MB
Step 1/4 : FROM openjdk:8-jdk-alpine
 <span class="nt">---</span><span class="o">&gt;</span> 792ff45a2a17
Step 2/4 : COPY target/machine-ip-0.0.1.jar app.jar
 <span class="nt">---</span><span class="o">&gt;</span> Using cache
 <span class="nt">---</span><span class="o">&gt;</span> 436597bf8464
Step 3/4 : EXPOSE 8080
 <span class="nt">---</span><span class="o">&gt;</span> Using cache
 <span class="nt">---</span><span class="o">&gt;</span> 0737665c2f88
Step 4/4 : ENTRYPOINT <span class="o">[</span><span class="s2">"java"</span>,<span class="s2">"-jar"</span>,<span class="s2">"/app.jar"</span><span class="o">]</span>
 <span class="nt">---</span><span class="o">&gt;</span> Using cache
 <span class="nt">---</span><span class="o">&gt;</span> 62ee4df459e4
Successfully built 62ee4df459e4
Successfully tagged incrediblevicky/machine-ip:0.0.1
</code></pre></div></div>

<p>We can verify the image created:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker images

REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE
incrediblevicky/machine-ip      0.0.1               62ee4df459e4        2 hours ago         122MB
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h2 id="running-docker-image">Running Docker image</h2>

<p>To run the docker image we will use</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-p</span> 8080:8080 <span class="nt">-t</span> incrediblevicky/machine-ip:0.0.1
</code></pre></div></div>

<p>Here, we are mapping 8080 port of host machine to port 8080 of docker container, and running the container by tag name.</p>

<p>And as expected, we can now hit “http://localhost:8080/ip”. But this time hostname and ip has changed. Its the containers ip &amp; hostname.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl localhost:8080/ip

<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"172.17.0.2"</span>,<span class="s2">"hostname"</span>:<span class="s2">"38abfd9a4016"</span><span class="o">}</span>
</code></pre></div></div>

<h2 id="push-the-images-to-docker-hub">Push the images to docker-hub</h2>
<p>First we need to login to docker, just provide your docker id &amp; password when asked, in my case, my username is incrediblevicky</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker login

Login with your Docker ID to push and pull images from Docker Hub. If you don<span class="s1">'t have a Docker ID, head over to https://hub.docker.com to create one.
Username: incrediblevicky
Password: 
Login Succeeded
</span></code></pre></div></div>
<p>Once, you have successfully logged in we will push the image to docker hub. *use docker push <DOCKER_ID>/machine-ip:0.0.1</DOCKER_ID></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker push incrediblevicky/machine-ip:0.0.1
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Now we are ready with our setup, time for Kubernetes.</p>

<h1 id="creating-deployment-descriptor-for-kubernetes">Creating Deployment descriptor for Kubernetes</h1>
<p>Create a new yaml file. For this exercise we will use Deployment.yaml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">machine-ip</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">machine-ip</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">machine-ip</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">machine-ip</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">machine-ip</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">incrediblevicky/machine-ip:0.0.1</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
      <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Always</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">machine-ip</span>
</code></pre></div></div>

<p>In this example:</p>

<ul>
  <li>A Deployment named machine-ip is created, indicated by the .metadata.name field.</li>
  <li>The Deployment creates 1 replicated Pods, indicated by the replicas field.</li>
  <li>The selector field defines how the Deployment finds which Pods to manage. In this case, you simply select a label that is defined in the Pod template (<em>app: machine-ip</em>). However, more sophisticated selection rules are possible, as long as the Pod template itself satisfies the rule.</li>
  <li>The template field contains the following sub-fields:
    <ul>
      <li>The Pods are labeled <em>app: machine-ip</em> using the <em>labels</em> field.</li>
      <li>The Pod template’s specification, or .template.spec field, indicates that the Pods run one container, <em>machine-ip</em>, which runs the <em>incrediblevicky/machine-ip</em> Docker Hub image at version <em>0.0.1</em>.</li>
      <li>Create one container and name it <em>machine-ip</em> using the <em>name</em> field</li>
      <li>Run the <em>incrediblevicky/machine-ip</em> image at version 0.0.1</li>
      <li>Open port <em>8080</em> so that the container can send and accept traffic.</li>
    </ul>
  </li>
</ul>

<p>To create this Deployment, run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> Deployment.yaml
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>Next, run <code class="language-plaintext highlighter-rouge">kubectl get deployments</code>. The output is similar to the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get deployments

NAME         DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
machine-ip   1         1         1            1           31s
</code></pre></div></div>

<p>When you inspect the Deployments in your cluster, the following fields are displayed:</p>

<ul>
  <li><strong>NAME</strong> lists the names of the Deployments in the cluster.</li>
  <li><strong>DESIRED</strong> displays the desired number of replicas of the application, which you define when you create the Deployment. This is the desired state.</li>
  <li><strong>CURRENT</strong> displays how many replicas are currently running.</li>
  <li><strong>UP-TO-DATE</strong> displays the number of replicas that have been updated to achieve the desired state.</li>
  <li><strong>AVAILABLE</strong> displays how many replicas of the application are available to your users.</li>
  <li><strong>AGE</strong> displays the amount of time that the application has been running.</li>
</ul>

<p>Running get pods should now show the new Pods:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get pods

NAME                          READY     STATUS    RESTARTS   AGE
machine-ip-5764588bdf-rtmr4   1/1       Running   0          12m
</code></pre></div></div>

<p>We have successfully deployed our first app to docker, but we still can’t access the url, So we need create service.</p>

<h1 id="creating-service-descriptor-for-kubernetes">Creating Service descriptor for Kubernetes</h1>
<p>A Service in Kubernetes is a REST object, similar to a Pod. Like all of the REST objects, a Service definition can be POSTed to the apiserver to create a new instance. For example, suppose you have a set of Pods that each expose port 8080 and carry a label “app=machine-ip”.</p>

<p>Create another yaml file. For this exercise we will use Service.yaml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">machine-ip-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">machine-ip</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">8080</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8080</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>
</code></pre></div></div>

<p>This specification will create a new Service object named “machine-ip-service” which targets TCP port 8080 on any Pod with the “app=machine-ip” label. This Service will also be assigned an IP address (sometimes called the “cluster IP”), which is used by the service proxies. The Service’s selector will be evaluated continuously and the results will be POSTed to an Endpoints object also named “machine-ip-service”.</p>

<p>To create this Deployment, run the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> Service.yaml

service <span class="s2">"machine-ip-service"</span> created
</code></pre></div></div>

<p>Run the following command to verify  if Service has been created successfully.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get services

NAME                 TYPE           CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>          AGE
kubernetes           ClusterIP      10.96.0.1        &lt;none&gt;        443/TCP          5h
machine-ip-service   LoadBalancer   10.104.164.245   localhost     8080:30420/TCP   5s
</code></pre></div></div>

<p>Since a machine-ip-service has been created, lets try to access the endpoint:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl localhost:8080/ip

<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
</code></pre></div></div>

<p>Congratulations you have you first app deployed on kubernetes</p>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<h1 id="a-simple-client">A simple client</h1>
<p>Before we move to last section, let create a simple client to make multiple rest calls.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/sh</span>

<span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..10<span class="o">}</span>
<span class="k">do
   </span><span class="nv">response</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">-sb</span> <span class="nt">-H</span> <span class="s2">"Accept: application/json"</span> <span class="s2">"http://localhost:8080/ip"</span><span class="si">)</span>
   <span class="nb">echo</span> <span class="k">${</span><span class="nv">response</span><span class="k">}</span>
<span class="k">done</span>
</code></pre></div></div>

<p>When we run this client, we get 10 response, which is from the same machine.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./client.sh 

<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
</code></pre></div></div>

<h1 id="loadbalancing-with-kubernetes">LoadBalancing with Kubernetes</h1>

<p>Currently, we have only one pod running, suddenly the traffic has increased tremendously and we need to scale our app, what to do …</p>

<p>Simply increase the replica set &amp; let kubernetes handle the complexity.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl scale <span class="nt">--replicas</span><span class="o">=</span>5 deployment/machine-ip

deployment.extensions <span class="s2">"machine-ip"</span> scaled
</code></pre></div></div>

<p>Now, lets check the available pods:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get pods
                                
NAME                          READY     STATUS    RESTARTS   AGE
machine-ip-5764588bdf-2sfxs   1/1       Running   0          13s
machine-ip-5764588bdf-5g9wc   1/1       Running   0          13s
machine-ip-5764588bdf-fh4v5   1/1       Running   0          13s
machine-ip-5764588bdf-nh4mh   1/1       Running   0          13s
machine-ip-5764588bdf-rtmr4   1/1       Running   0          1h
</code></pre></div></div>

<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<p><ins class="adsbygoogle" style="display:block; text-align:center;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-4166026699724584" data-ad-slot="8512487719"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></p>

<p>We see 4 new pods have been created instantly. Lets see what happens when make multiple client requests</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./client.sh

<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.8"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-2sfxs"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.5"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-5g9wc"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.6"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-fh4v5"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.6"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-fh4v5"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.5"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-5g9wc"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.7"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-nh4mh"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.5"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-5g9wc"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.6"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-fh4v5"</span><span class="o">}</span>
</code></pre></div></div>
<p>If you observe, the requests are catered through different containers.</p>

<p>Similarly we can scale down, test the endpoint again</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl scale <span class="nt">--replicas</span><span class="o">=</span>2 deployment/machine-ip

deployment.extensions <span class="s2">"machine-ip"</span> scaled

<span class="nv">$ </span>kubectl get pods

NAME                          READY     STATUS        RESTARTS   AGE
machine-ip-5764588bdf-fh4v5   0/1       Terminating   0          7m
machine-ip-5764588bdf-nh4mh   1/1       Running       0          7m
machine-ip-5764588bdf-rtmr4   1/1       Running       0          1h


<span class="nv">$ </span>./client.sh 

<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.7"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-nh4mh"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.7"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-nh4mh"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.7"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-nh4mh"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.7"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-nh4mh"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.7"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-nh4mh"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.7"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-nh4mh"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
<span class="o">{</span><span class="s2">"ip"</span>:<span class="s2">"10.1.0.4"</span>,<span class="s2">"hostname"</span>:<span class="s2">"machine-ip-5764588bdf-rtmr4"</span><span class="o">}</span>
</code></pre></div></div>

<p>We successfully scaled down our application.</p>

<h1 id="conclusion">Conclusion</h1>
<p>In this article we installed docker with kubernetes, created a docker image of a java app, pushed it to docker-hub. Then we created our Kubernetes deployment &amp; services, and started our first pod. We also looked at how kubernetes handles scaling effortlessly.</p>

<p>You can find the complete code on <a href="https://github.com/kuros/blog-code/tree/master/k8s/machine-ip">github</a></p>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/kubernetes" class="page__taxonomy-item" rel="tag">kubernetes</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-02-08T00:00:00+05:30">February 8, 2019</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Running+First+Kubernetes+Pod+on+Mac+%28Windows%29%20https%3A%2F%2Fkuros.in%2Fkubernetes%2Frunning-first-kubernetes-pod-on-mac%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fkuros.in%2Fkubernetes%2Frunning-first-kubernetes-pod-on-mac%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fkuros.in%2Fkubernetes%2Frunning-first-kubernetes-pod-on-mac%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/kubernetes/kubernetes-basics/" class="pagination--pager" title="Kubernetes(k8s) Basics
">Previous</a>
    
    
      <a href="/react/2019/03/react-with-typescript/" class="pagination--pager" title="Create React App Using Typescript
">Next</a>
    
  </nav>

    </div>
    
    <div class="page__ads__related">
      


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>  

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/messaging/publish-and-consume-kafka-message-in-spring-boot-applicaton/" rel="permalink">Kafka Messaging with Spring Boot
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In my previous article we looked at setting up Kafka on our local machine. Now we will write a spring boot application and integrate Kafka messaging.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/messaging/getting-started-with-kafka-install-and-messaging/" rel="permalink">Getting started with kafka messaging
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In recent times the Kafka has become a buzzword in the industry, it all started with Linkedin trying to manage the large amount of the data across different ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/jfirebase/jFirebase-a-firebase-wrapper-for-java-developers/" rel="permalink">jFirebase - Entity Framework for Firebase/Firestore
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">I decided to tryout firebase for my personal projects &amp; learning, having come from traditional SQL background, I am well versed with JPA/Hibernate when d...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/java/microservices/2019/08/parallel-service-execution-in-microservices-architecture-using-completable-future/" rel="permalink">Making parallel service calls in microservice architecture.
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          4 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Not so long ago, when I started my development journey, we use to work with single monolith project. The work culture was pretty different compared to curren...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
  
</div>

<div class="page">
  


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal - responsive -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-4166026699724584"
     data-ad-slot="7276848543"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/incrv83" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/kuros" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Kuros.in. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131802948-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131802948-1', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://kuros.in/kubernetes/running-first-kubernetes-pod-on-mac/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/kubernetes/running-first-kubernetes-pod-on-mac"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://kuros-in.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  



  
    <script src="/assets/js/custom.js"></script>
  



  </body>
</html>
